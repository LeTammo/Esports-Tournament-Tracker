<div class="card mb-4">
  <div class="card-body">
    <div class="section-header d-flex justify-content-between align-items-center">
      <h5 class="card-title m-0">Tournaments</h5>
    </div>
    <% const hasAny = (currentTournaments && currentTournaments.length) || (upNextTournaments && upNextTournaments.length) || (nextTournaments && nextTournaments.length) || (pastTournaments && pastTournaments.length); %>
    <% if (!hasAny) { %>
      <div class="text-muted">No tournaments found for this selection.</div>
    <% } else { %>
      <% if (currentTournaments && currentTournaments.length) { %>
        <div class="category-block mb-3">
          <div class="category-title text-success">Currently live</div>
          <ul class="list-group clean-list" id="tournament-list">
            <% currentTournaments.forEach((t, idx) => { %>
              <li class="list-group-item tournament-item highlight-current<%= t.included === false && filters && (filters.include.length || filters.exclude.length) ? ' filtered d-none' : '' %>" data-included="<%= t.included %>" data-idx="c-<%= idx %>">
                <div class="ti-row d-flex align-items-center">
                  <div class="ti-main flex-grow-1">
                    <div class="ti-name"><%= t.name %></div>
                    <div class="ti-meta"><span><%= t.start_date %></span><span class="sep">–</span><span><%= t.end_date %></span></div>
                  </div>
                  <div class="ti-aside d-flex flex-column align-items-end gap-2">
                    <span class="badge bg-info text-dark"><%= t.location %></span>
                    <span class="badge bg-secondary">Prize: <%= t.prize_pool %></span>
                  </div>
                </div>
              </li>
            <% }) %>
          </ul>
        </div>
      <% } else if (upNextTournaments && upNextTournaments.length) { %>
        <div class="category-block mb-3">
          <div class="category-title text-info">Upcoming</div>
          <ul class="list-group clean-list" id="tournament-list">
            <% upNextTournaments.forEach((t, idx) => { %>
              <li class="list-group-item tournament-item highlight-upnext<%= t.included === false && filters && (filters.include.length || filters.exclude.length) ? ' filtered d-none' : '' %>" data-included="<%= t.included %>" data-idx="u-<%= idx %>">
                <div class="ti-row d-flex align-items-center">
                  <div class="ti-main flex-grow-1">
                    <div class="ti-name"><%= t.name %></div>
                    <div class="ti-meta"><span><%= t.start_date %></span><span class="sep">–</span><span><%= t.end_date %></span></div>
                  </div>
                  <div class="ti-aside d-flex flex-column align-items-end gap-2">
                    <span class="badge bg-info text-dark"><%= t.location %></span>
                    <span class="badge bg-secondary">Prize: <%= t.prize_pool %></span>
                  </div>
                </div>
              </li>
            <% }) %>
          </ul>
        </div>
      <% } %>

      <% if (nextTournaments && nextTournaments.length) { %>
        <div class="category-block mb-3">
          <div class="category-title text-primary">Next up</div>
          <ul class="list-group clean-list" id="tournament-list">
            <% nextTournaments.forEach((t, idx) => { %>
              <li class="list-group-item tournament-item<%= t.included === false && filters && (filters.include.length || filters.exclude.length) ? ' filtered d-none' : '' %>" data-included="<%= t.included %>" data-idx="n-<%= idx %>">
                <div class="ti-row d-flex align-items-center">
                  <div class="ti-main flex-grow-1">
                    <div class="ti-name"><%= t.name %></div>
                    <div class="ti-meta"><span><%= t.start_date %></span><span class="sep">–</span><span><%= t.end_date %></span></div>
                  </div>
                  <div class="ti-aside d-flex flex-column align-items-end gap-2">
                    <span class="badge bg-info text-dark"><%= t.location %></span>
                    <span class="badge bg-secondary">Prize: <%= t.prize_pool %></span>
                  </div>
                </div>
              </li>
            <% }) %>
          </ul>
        </div>
      <% } %>

      <% if (pastTournaments && pastTournaments.length) { %>
        <div class="category-block">
          <div class="d-flex align-items-center justify-content-between">
            <div class="category-title text-muted">Past tournaments</div>
            <button class="icon-toggle" type="button" id="toggle-past" aria-expanded="false" aria-controls="past-list" title="Toggle past" aria-label="Toggle past">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="chevron">
                <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
          <ul class="list-group clean-list d-none" id="past-list">
            <% pastTournaments.forEach((t, idx) => { %>
              <li class="list-group-item tournament-item past-item<%= t.included === false && filters && (filters.include.length || filters.exclude.length) ? ' filtered d-none' : '' %>" data-included="<%= t.included %>" data-idx="p-<%= idx %>">
                <div class="ti-row d-flex align-items-center">
                  <div class="ti-main flex-grow-1">
                    <div class="ti-name"><%= t.name %></div>
                    <div class="ti-meta"><span><%= t.start_date %></span><span class="sep">–</span><span><%= t.end_date %></span></div>
                  </div>
                  <div class="ti-aside d-flex flex-column align-items-end gap-2">
                    <span class="badge bg-info text-dark"><%= t.location %></span>
                    <span class="badge bg-secondary">Prize: <%= t.prize_pool %></span>
                  </div>
                </div>
              </li>
            <% }) %>
          </ul>
          <script>
            (function(){
              document.addEventListener('DOMContentLoaded', function(){
                var btn = document.getElementById('toggle-past');
                var list = document.getElementById('past-list');
                if (!btn || !list) return;
                btn.addEventListener('click', function(){
                  var willShow = list.classList.contains('d-none');
                  if (willShow){
                    list.classList.remove('d-none');
                    btn.classList.add('open');
                    btn.setAttribute('aria-expanded','true');
                  } else {
                    list.classList.add('d-none');
                    btn.classList.remove('open');
                    btn.setAttribute('aria-expanded','false');
                  }
                });
              });
            })();
          </script>
        </div>
      <% } %>
    <% } %>
  </div>
</div>

